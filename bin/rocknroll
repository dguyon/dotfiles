#!/usr/bin/env zsh

setopt extendedglob

if ! type 'brew' > /dev/null; then
  echo '--> Installing Homebrew'
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

echo '--> Add extras Homebrew formulas'
brew tap caskroom/fonts
brew tap caskroom/versions

echo '--> Make sure Homebrew is up to date'
brew update

echo '--> Upgrade installed formulas'
brew upgrade

echo '--> BREW ALL THE THINGS!'
brew install curl --force --with-libssh2 --with-openssl --with-nghttp2
brew install openssl
brew install homebrew/dupes/make --with-default-names
brew install gnu-tar --with-default-names
brew install gnu-which --with-default-names
brew install git --with-curl --with-openssl --with-blk-sha1 --with-persistent-https
brew install bash
brew install zsh
brew install ripgrep
brew install coreutils
brew install wget
brew install midnight-commander
brew install mtr --with-glib
brew install htop
brew install md5sha1sum
brew install pv
brew install rsync
brew install ssh-copy-id
brew install shellcheck
brew install ghostscript
brew install mas
brew install tree
brew install homebrew/dupes/nano
brew install jq
brew install watch
brew install ctop
brew install tig
brew install tmate
brew install docker-machine-driver-xhyve
brew install shfmt
brew install editorconfig

echo '--> CASK ALL THE THINGS!'
brew cask install font-ubuntu
brew cask install font-hack
brew cask install font-fira-code

brew cask install xquartz

brew cask install hyper
brew cask install vlc
brew cask install google-chrome
brew cask install firefox
brew cask install keepassx
brew cask install dropbox
brew cask install whatsapp
brew cask install android-file-transfer
brew cask install imagealpha
brew cask install visual-studio-code
brew cask install sublime-text
brew cask install iterm2
brew cask install recordit

brew install gpg
brew cask install gpgtools

echo '--> LETS CODE!'

# Python
brew install python
pip2 install -U setuptools pip autopep8
pip3 install -U setuptools pip autopep8

# Ruby
brew install ruby
gem update --system
# gem pristine --all --only-executables

# Go
brew install go

go get -u github.com/codesenberg/bombardier
go get -u github.com/tj/mmake/cmd/mmake
alias make=mmake

# Node.js
brew install node --with-openssl --without-icu4c

# yarn
brew install yarn

npm i -g npm@latest
npm i -g speed-test@latest

# image manipulation, compression
brew install imagemagick
brew install zopfli
brew install guetzli
brew install mozjpeg

npm i -g imageoptim-cli@latest
npm i -g imagemin-cli@latest

# local files
if [ ! -f ~/.localrc ]; then
  touch ~/.localrc

  echo "Configure a profile \`DOTPROFILE\` in \`~/.zshrc_local\`:"
  read -r DOTPROFILE

  echo "export DOTPROFILE=$DOTPROFILE" > ~/.localrc
  source ~/.localrc
fi

if [ ! -f ~/.gitconfig_local ]; then
  echo "[github]\n  user = USERNAME\n[user]\n  name = FIRSTNAME LASTNAME\n  email = EMAIL" > ~/.gitconfig_local
  read "Configure now your git informations in \`~/.gitconfig_local\` and press [Enter] when done..."
fi

if [ -f $HOME/.dotfiles/profiles/$DOTPROFILE/rocknroll ]; then
  source $HOME/.dotfiles/profiles/$DOTPROFILE/rocknroll
fi

echo '--> Cleanup Homebrew formulas'
brew prune

brew cleanup
brew cask cleanup

echo '--> Refreshing terminal'
exec $SHELL --login
