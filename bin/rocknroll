#!/usr/bin/env zsh

setopt extendedglob

if ! type 'brew' > /dev/null; then
  echo '--> Installing Homebrew'
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

echo '--> Add extras Homebrew formulas'
brew tap homebrew/dupes
brew tap homebrew/homebrew-php
brew tap caskroom/versions
brew tap caskroom/fonts

echo '--> Make sure Homebrew is up to date'
brew update && brew cask update

echo '--> Upgrade installed formulas'
brew upgrade

echo '--> BREW ALL THE THINGS!'
brew install curl --with-libssh2 --with-openssl --with-nghttp2 && brew unlink curl && brew link curl --force
brew install gettext && brew unlink gettext && brew link gettext --force
brew install openssl
brew install homebrew/dupes/make --with-default-names
brew install gnu-sed --with-default-names
brew install gnu-tar --with-default-names
brew install gnu-which --with-default-names
brew install git --with-brewed-curl --with-brewed-openssl
brew install bash
brew install zsh
brew install zsh-completions
brew install the_silver_searcher
brew install ripgrep
brew install coreutils
brew install wget
brew install midnight-commander
brew install mtr --with-glib
brew install htop
brew install md5sha1sum
brew install pv
brew install rsync
brew install ssh-copy-id
brew install heroku
brew install shellcheck
brew install imagemagick
brew install zopfli
brew install ghostscript
brew install mas

echo '--> CASK ALL THE THINGS!'
brew cask install font-ubuntu
brew cask install font-hack

brew cask install xquartz
brew cask install virtualbox

brew cask install vagrant
vagrant plugin install vagrant-hostsupdater
vagrant plugin install vagrant-triggers
vagrant plugin install vagrant-bindfs

brew cask install docker # Docker for Mac

brew cask install gpgtools
brew cask install vlc
brew cask install google-chrome
brew cask install firefox
brew cask install iterm2
brew cask install onyx
brew cask install keepassx
brew cask install dropbox
brew cask install whatsapp
brew cask install android-file-transfer
brew cask install imagealpha
brew cask install anatine

echo '--> LETS CODE!'

# Python
brew install python
pip install -U setuptools
pip install -U pip
pip install -U autopep8 

# Ruby
brew install ruby
gem update --system
# gem pristine --all --only-executables

# Go
brew install go

# Node.js
brew install node --with-openssl --without-npm
mkdir -p "$HOME/.npm-packages"

if ! type 'npm' > /dev/null; then
  curl -sSL https://www.npmjs.com/install.sh | sh
fi

# yarn
brew install yarn

npm install --global npm@4
npm install --global speed-test@latest

# local files
if [ ! -f ~/.localrc ]; then
  touch ~/.localrc
  
  echo "Configure a profile \`PROFILE\` in \`~/.zshrc_local\`:"
  read -r PROFILE
  
  echo "export PROFILE=$PROFILE" > ~/.localrc
  source ~/.localrc
fi

if [ ! -f ~/.gitconfig_local ]; then
  echo "[github]\n  user = USERNAME\n[user]\n  name = FIRSTNAME LASTNAME\n  email = EMAIL" > ~/.gitconfig_local
  read "Configure now your git informations in \`~/.gitconfig_local\` and press [Enter] when done..."
fi

if [ -f $HOME/.dotfiles/profiles/$PROFILE/rocknroll ]; then
  source $HOME/.dotfiles/profiles/$PROFILE/rocknroll
fi

echo '--> Cleanup Homebrew formulas'
brew cleanup
brew cask cleanup

# slimzsh
if [ -d "$HOME/.slimzsh" ]; then
  echo '--> Updating slimzsh'
  cd "$HOME/.slimzsh/"
  git pull --prune
  git submodule update --init --recursive
  cd -
else
  echo '--> Installing slimzsh'
  git clone --recursive https://github.com/changs/slimzsh.git "$HOME/.slimzsh"
fi

echo '--> Symlinking dot files'
for dotfile in "${ZDOTDIR:-$HOME}"/.dotfiles/.{agignore,aliases,functions,gemrc,npmrc,gitconfig,gitignore_global,zprofile,zlogout,zshrc}; do
  ln -sf "$dotfile" "${ZDOTDIR:-$HOME}/${dotfile:t}" 2> /dev/null
done

exec $SHELL
